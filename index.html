<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Renuterra - Single Route Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-primary: #0b2b51;
            --color-secondary: #3ba935;
            --text-light: #f9fafb;
            --text-medium: #667085;
            --text-dark: #344054;
            --bg-main: #0b2b51;
            --bg-card: #ffffff;
            --bg-kpi: #f9fafb;
            --bg-better: #e1f5e0;
            --bg-worse: #fbe6e6;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-main); color: var(--text-light); }
        .tab-active { border-color: var(--color-secondary); color: var(--color-secondary); background-color: var(--bg-card); border-bottom-color: var(--bg-card); }
        .tab-inactive { border-color: transparent; color: var(--text-medium); }
        .card { background-color: var(--bg-card); color: var(--text-dark); border-radius: 0.75rem; box-shadow: 0 1px 2px 0 rgba(0,0,0,0.05); padding: 1.5rem; }
        .card-header { font-size: 1.125rem; font-weight: 600; color: var(--text-dark); border-bottom: 1px solid #e5e7eb; padding-bottom: 0.75rem; margin-bottom: 1rem; }
        .label { display: block; font-size: 0.875rem; font-weight: 500; color: var(--text-dark); margin-bottom: 0.25rem; }
        .input { width: 100%; border-radius: 0.375rem; border: 1px solid #d1d5db; padding: 0.5rem 0.75rem; font-size: 0.875rem; color: var(--text-dark); }
        .input:disabled { background-color: #f3f4f6; cursor: not-allowed; }
        .input-sm { padding: 0.25rem 0.5rem; font-size: 0.8rem; }
        .input-group { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .btn { padding: 0.5rem 1rem; border-radius: 0.375rem; font-weight: 600; text-align: center; transition: background-color 0.2s; cursor: pointer; }
        .btn-primary { background-color: var(--color-secondary); color: white; }
        .btn-primary:hover { background-color: #32932f; }
        .btn-secondary { background-color: #e5e7eb; color: var(--text-dark); }
        .loader { border: 5px solid #f3f3f3; border-top: 5px solid var(--color-secondary); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        h1, h2, h3 { color: var(--text-light); }
        .card h1, .card h2, .card h3, .card p, .card span, .card div, .card table { color: var(--text-dark); }
        .card .text-gray-500 { color: var(--text-medium) !important; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-screen-xl mx-auto space-y-8">
        <header class="flex items-center justify-between">
            <div class="flex items-center gap-4">
                <h1 class="text-2xl font-bold">Single Route Analysis</h1>
            </div>
            <p class="text-sm hidden md:block">Analyze the performance and efficiency of a single route based on its plan.</p>
        </header>

        <!-- Route Selection View -->
        <div id="routeSelectionView">
            <div class="card">
                <h2 class="card-header">Select a Route to Analyze</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                    <div>
                        <label for="filterDate" class="label">Date</label>
                        <input type="date" id="filterDate" class="input" value="2025-10-15">
                    </div>
                    <div>
                        <label for="filterOperation" class="label">Operation</label>
                        <select id="filterOperation" class="input">
                            <option selected>Dubai Medical</option>
                        </select>
                    </div>
                    <div class="self-end">
                        <button id="searchRoutesBtn" class="btn btn-primary w-full">Search Routes</button>
                    </div>
                </div>
                <div class="mt-6 overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="p-3 font-semibold">Route</th>
                                <th class="p-3 font-semibold">Shift</th>
                                <th class="p-3 font-semibold">Planned Time</th>
                                <th class="p-3 font-semibold">Vehicle</th>
                                <th class="p-3 font-semibold">Action</th>
                            </tr>
                        </thead>
                        <tbody id="routeListBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Simulation View -->
        <main id="simulationView" class="hidden space-y-8">
            <div class="bg-white p-4 rounded-lg flex justify-between items-center">
                <div>
                    <h2 class="text-xl font-bold text-gray-800" id="selectedRouteName"></h2>
                    <p class="text-sm text-gray-500" id="selectedRouteInfo"></p>
                </div>
                <button id="changeRouteBtn" class="btn btn-secondary">Change Route</button>
            </div>

            <!-- Controls Section -->
            <div class="card !p-0">
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex gap-x-6 px-6">
                        <button id="paramsTabBtn" class="tab-active py-4 px-1 text-sm font-medium border-b-2">Parameters</button>
                        <button id="stopsTabBtn" class="tab-inactive py-4 px-1 text-sm font-medium border-b-2">All Route Stops</button>
                    </nav>
                </div>
                <div id="paramsView" class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Time & Traffic Section -->
                        <div class="space-y-4 p-4 border rounded-lg">
                             <h3 class="font-semibold text-gray-800">Time & Traffic</h3>
                            <div class="input-group">
                                <div><label class="label">Planned Start Time</label><input id="plannedStartTime" type="time" class="input" readonly disabled></div>
                                <div><label class="label">Planned End Time</label><input id="plannedEndTime" type="time" class="input" readonly disabled></div>
                            </div>
                            <div class="input-group">
                                <div><label class="label">Avg. Speed (km/h)</label><input id="avgSpeed" type="number" class="input" value="40"></div>
                                <div><label class="label">Road Factor</label><input id="roadFactor" type="number" class="input" value="1.3" step="0.1"></div>
                            </div>
                            <div>
                                <label class="label">Default Service Time (min)</label>
                                <input id="defaultServiceTime" type="number" class="input" value="15">
                            </div>
                        </div>
                        <!-- Costs Section -->
                        <div class="space-y-4 p-4 border rounded-lg">
                            <h3 class="font-semibold text-gray-800">Costs & Constraints</h3>
                             <div><label class="label">Vehicle Capacity (kg)</label><input id="vehicleCapacity" type="number" class="input" value="2000"></div>
                            <div class="input-group">
                                <div><label class="label">Cost per km (AED)</label><input id="costPerKm" type="number" class="input" value="3.5"></div>
                                <div><label class="label">Cost per Hour (AED)</label><input id="costPerHour" type="number" class="input" value="80"></div>
                            </div>
                        </div>
                         <!-- Break Section -->
                        <div class="space-y-4 p-4 border rounded-lg">
                            <h3 class="font-semibold text-gray-800">Break Window</h3>
                            <div class="input-group">
                                <div><label class="label">Break Start</label><input id="breakStart" type="time" class="input" value="12:00"></div>
                                <div><label class="label">Break End</label><input id="breakEnd" type="time" class="input" value="13:00"></div>
                            </div>
                        </div>
                    </div>
                     <button id="runSimBtn" class="w-full btn btn-primary text-lg mt-8">Run Simulation</button>
                </div>
                <div id="stopsView" class="hidden p-6">
                    <div class="max-h-[600px] overflow-y-auto">
                        <table class="w-full text-sm text-left">
                            <thead class="bg-gray-100 sticky top-0 z-10">
                                <tr>
                                    <th class="p-2 font-semibold">#</th>
                                    <th class="p-2 font-semibold">SERVICE POINT</th>
                                    <th class="p-2 font-semibold">Waste (kg)</th>
                                    <th class="p-2 font-semibold">SERVICE TIME (min)</th>
                                </tr>
                            </thead>
                            <tbody id="stopsTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Results Section (Placeholder) -->
            <div id="loaderContainer" class="hidden h-full items-center justify-center py-20">
                <div class="text-center">
                    <div class="loader mx-auto"></div>
                    <p class="mt-4 text-gray-300 font-semibold">Running simulation, please wait...</p>
                </div>
            </div>
            <div id="resultsContainer" class="hidden space-y-8">
                 <!-- The final output design will be placed here -->
                 <div class="card text-center">
                    <p class="text-lg">Simulation results will be displayed here.</p>
                 </div>
            </div>
        </main>
    </div>

<script>
// --- DATA ---
const allRoutes = [
    {
        name: 'DMED101',
        date: '2025-10-15',
        startTime: '09:00',
        endTime: '17:00',
        operation: 'Dubai Medical',
        shift: 'Day Shift',
        vehicle: 'DXBCC40925',
        sequence: [
            { id: "FIRST IVF", order: 1, lat: 25.2338, lon: 55.3184, kg: 29.00 },
            { id: "FIRST GENOMIX", order: 2, lat: 25.2339, lon: 55.3184, kg: 6.00 },
            { id: "CLINICA SABAH", order: 3, lat: 25.2406, lon: 55.2951, kg: 101.00 },
            { id: "AH Dubai Clinic Al Barsha", order: 4, lat: 25.0992, lon: 55.2006, kg: 5.00 },
            { id: "Al Zahra Hospital", order: 5, lat: 25.1060, lon: 55.1805, kg: 0.00 },
            { id: "AH Dubai Hills", order: 6, lat: 25.1028, lon: 55.2377, kg: 8.00 },
            { id: "AH Media City", order: 7, lat: 25.1009, lon: 55.1696, kg: 14.00 },
            { id: "Jumeirah American Clinic", order: 8, lat: 25.1513, lon: 55.2135, kg: 4.00 },
            { id: "ALABAMA DENTAL", order: 9, lat: 25.1550, lon: 55.2166, kg: 3.00 },
            { id: "DYNASTY CLINIC", order: 10, lat: 25.1659, lon: 55.2329, kg: 17.00 },
            { id: "AH Al Khawaneej", order: 11, lat: 25.2345, lon: 55.4731, kg: 6.00 },
        ]
    }
];

let selectedRouteData = {};

// --- UI & MAIN ORCHESTRATION ---
function filterAndDisplayRoutes() {
    const date = document.getElementById('filterDate').value;
    const operation = document.getElementById('filterOperation').value;
    const tableBody = document.getElementById('routeListBody');
    tableBody.innerHTML = '';

    const filtered = allRoutes.filter(route => route.date === date && route.operation === operation);

    if (filtered.length === 0) {
        tableBody.innerHTML = `<tr><td colspan="5" class="text-center p-4 text-gray-500">No routes found.</td></tr>`;
        return;
    }

    filtered.forEach(route => {
        const row = `
            <tr class="border-b hover:bg-gray-50">
                <td class="p-3 font-semibold">${route.name}</td>
                <td class="p-3">${route.shift}</td>
                <td class="p-3">${route.startTime} - ${route.endTime}</td>
                <td class="p-3">${route.vehicle}</td>
                <td class="p-3">
                    <button class="btn btn-primary select-route-btn" data-route-name="${route.name}">Select</button>
                </td>
            </tr>
        `;
        tableBody.insertAdjacentHTML('beforeend', row);
    });

    document.querySelectorAll('.select-route-btn').forEach(btn => {
        btn.addEventListener('click', (e) => selectRoute(e.target.dataset.routeName));
    });
}

function selectRoute(routeName) {
    selectedRouteData = allRoutes.find(r => r.name === routeName);
    if (!selectedRouteData) return;

    document.getElementById('routeSelectionView').classList.add('hidden');
    document.getElementById('simulationView').classList.remove('hidden');

    document.getElementById('selectedRouteName').textContent = `Analyzing Route: ${selectedRouteData.name}`;
    document.getElementById('selectedRouteInfo').textContent = `${selectedRouteData.operation} | ${selectedRouteData.date}`;

    document.getElementById('plannedStartTime').value = selectedRouteData.startTime;
    document.getElementById('plannedEndTime').value = selectedRouteData.endTime;
    
    populateStopsTable();
}

function populateStopsTable() {
    const tableBody = document.getElementById('stopsTableBody');
    if (!selectedRouteData || !selectedRouteData.sequence) {
        tableBody.innerHTML = ''; return;
    }
    
    const allStops = selectedRouteData.sequence.sort((a,b) => a.order - b.order);
    const defaultTime = document.getElementById('defaultServiceTime').value;

    tableBody.innerHTML = allStops.map(sp => `
        <tr class="border-b bg-white even:bg-gray-50">
            <td class="p-2">${sp.order}</td>
            <td class="p-2 font-medium">${sp.id}</td>
            <td class="p-2">${sp.kg || 0}</td>
            <td class="p-2">
                <input type="number" class="input input-sm service-time-input" value="${defaultTime}" data-order="${sp.order}">
            </td>
        </tr>
    `).join('');
}


function setupEventListeners() {
    document.getElementById('searchRoutesBtn').addEventListener('click', filterAndDisplayRoutes);
    
    document.getElementById('changeRouteBtn').addEventListener('click', () => {
        document.getElementById('simulationView').classList.add('hidden');
        document.getElementById('routeSelectionView').classList.remove('hidden');
        document.getElementById('resultsContainer').classList.add('hidden');
    });

    document.getElementById('runSimBtn').addEventListener('click', () => {
        document.getElementById('resultsContainer').classList.add('hidden');
        document.getElementById('loaderContainer').classList.remove('hidden');
        // Placeholder for actual simulation run
        setTimeout(() => {
            document.getElementById('loaderContainer').classList.add('hidden');
            document.getElementById('resultsContainer').classList.remove('hidden');
        }, 1500);
    });

    const paramsTabBtn = document.getElementById('paramsTabBtn'), stopsTabBtn = document.getElementById('stopsTabBtn');
    const paramsView = document.getElementById('paramsView'), stopsView = document.getElementById('stopsView');
    const switchTabs = (activeTab) => {
        const isParams = activeTab === 'params';
        paramsTabBtn.classList.toggle('tab-active', isParams); paramsTabBtn.classList.toggle('tab-inactive', !isParams);
        stopsTabBtn.classList.toggle('tab-active', !isParams); stopsTabBtn.classList.toggle('tab-inactive', isParams);
        paramsView.classList.toggle('hidden', !isParams);
        stopsView.classList.toggle('hidden', isParams);
    };
    paramsTabBtn.addEventListener('click', () => switchTabs('params'));
    stopsTabBtn.addEventListener('click', () => switchTabs('stops'));
}

// --- INITIALIZATION ---
window.addEventListener('load', () => {
    setupEventListeners();
    filterAndDisplayRoutes();
});
</script>
</body>
</html>

